@page "/teams-list"
@using VolleyLeague.Client.Blazor.Services
@using VolleyLeague.Shared.Dtos.Teams
@inject HttpClient Http
@inject ITeamService TeamService

@if (!PageReady)
{
    <section id="loading_section" style="margin-top: 150px" class="loading_section">
        <div class="container">
            <div id="spinner"></div>
        </div>
    </section>
}
else
{
    <div class="rts-team-section inner section-gap">
        <div class="container">
            <div class="top-wrap">
                <div class="filter-button-group">
                    <button class="filter-btn team-list active" data-show=".liga1bls">1 Liga BLS</button>
                    <button class="filter-btn team-list" data-show=".liga1blsk">1 Liga BLSK</button>
                    <button class="filter-btn team-list" data-show=".liga2bls">2 Liga BLS</button>
                </div>
            </div>

            <div class="filterd-items liga1bls">
                <div class="team-section-inner inner">
                    <div class="row margin-top-min">
                        @foreach (var team in team1)
                        {
                            var imgSrc = team.Logo != null ? $"data:image/png;base64,{Convert.ToBase64String(team.Logo)}" : "/assets/images/Logo_alternative.png";
                            <div class="col-xl-4 col-md-4 col-sm-6">
                                <div class="team-wraper">
                                    <div class="player-card-white">
                                        <a class="image" href="team-details.html">
                                            <img src="@imgSrc" alt="Logo" class="team-logo">
                                        </a>
                                    </div>
                                    <div class="display-flex-column-center">
                                        <div class="display-flex-row margin-top-xs">
                                            <a href="/team/@team.Id/" class="team-list-check font-size">Profil</a>
                                            <a href="/team-result/@team.Id/" class="team-list-check font-size">Wyniki</a>
                                        </div>
                                        <a href="#" class="name header-text margin-top-xs">@team.Name.ToUpper()</a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="filterd-items liga1blsk">
                <div class="team-section-inner inner">
                    <div class="row margin-top-min">
                        @foreach (var team in team2)
                        {
                            var imgSrc = team.Logo != null ? $"data:image/png;base64,{Convert.ToBase64String(team.Logo)}" : "/assets/images/Logo_alternative.png";
                            <div class="col-xl-4 col-md-4 col-sm-6">
                                <div class="team-wraper">
                                    <div class="player-card-white">
                                        <a class="image" href="team-details.html">
                                            <img src="@imgSrc" alt="Logo" class="team-logo">
                                        </a>
                                    </div>
                                    <div class="display-flex-column-center">
                                        <div class="display-flex-row margin-top-xs">
                                            <a href="/team/@team.Id/" class="team-list-check">Profil</a>
                                            <a href="/team-result/@team.Id/" class="team-list-check">Wyniki</a>
                                        </div>
                                        <a href="#" class="name header-text margin-top-xs">@team.Name.ToUpper()</a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="filterd-items liga2bls">
                <div class="team-section-inner inner">
                    <div class="row margin-top-min">
                        @foreach (var team in team3)
                        {
                            var imgSrc = team.Logo != null ? $"data:image/png;base64,{Convert.ToBase64String(team.Logo)}" : "/assets/images/Logo_alternative.png";
                            <div class="col-xl-4 col-md-4 col-sm-6">
                                <div class="team-wraper">
                                    <div class="player-card-white">
                                        <a class="image" href="team-details.html">
                                            <img src="@imgSrc" alt="Logo" class="team-logo">
                                        </a>
                                    </div>
                                    <div class="display-flex-column-center">
                                        <div class="display-flex-row margin-top-xs">
                                            <a href="/team/@team.Id/" class="team-list-check">Profil</a>
                                            <a href="/team-result/@team.Id/" class="team-list-check">Wyniki</a>
                                        </div>
                                        <a href="#" class="name header-text margin-top-xs">@team.Name.ToUpper()</a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <section class="category_section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="mobile">
                        <p class="text-danger">@ErrorMessage</p>

                        <div class="container login">
                            <h2 class="text-center">POZOSTAŁE ZESPOŁY</h2>
                            <div class="form-group row" style="max-width:700px">
                                <label for="league">Liga:</label>
                                <select class="form-control" id="league" @onchange="UpdateLeague">
                                    @if (Leagues == null)
                                    {
                                        <option value="null" disabled>Ładowanie lig...</option>
                                    }
                                    else
                                    {
                                        <option value="null" selected disabled>Wybierz ligę</option>
                                        @foreach (LeagueDto league in Leagues)
                                        {
                                            <option value="@league.Id">@league.Name</option>
                                        }
                                    }

                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
}

<style>
    .nav-item.nav-user {
        color: #7d7d7d;
        text-decoration: none;
        font-size: 9px;
    }

    #spinner {
        width: 40px;
        height: 40px;
        border: 5px solid #ccc;
        border-top: 5px solid #007bff;
        border-radius: 50%;
        margin: 50px auto;
        animation: spin 1s linear infinite;
    }

    .display-flex-column-center {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        margin-top: 10px;
    }

    .display-flex-row {
        display: flex;
        flex-direction: row;
        gap: 10px;
    }

    .team-list-check {
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        text-decoration: none;
        color: #000;
        font-weight: bold;
    }

    .name.header-text {
        margin-top: 10px;
        font-size: 18px;
        font-weight: bold;
        color: #333;
    }
</style>

@code {
    public bool PageReady = false;

    public string ErrorMessage = "";

    public List<LeagueDto>? Leagues;

    public List<TeamDto>? Teams;

    public List<TeamDto>? team1;
    public List<TeamDto>? team2;
    public List<TeamDto>? team3;

    protected override async Task OnInitializedAsync()
    {
        await GetCurrentTopTeams();
        Leagues = await GetLeagues();

        if (Leagues != null && team1 != null && team2 != null && team3 != null)
        {
            PageReady = true;
        }
    }

    private async Task<List<LeagueDto>?> GetLeagues()
    {
        var leaguesResoponse = await TeamService.GetLeagues();
        return leaguesResoponse;
    }

    private async Task GetCurrentTopTeams()
    {
        team1 = await TeamService.GetTeamsByLeague(1);
        team2 = await TeamService.GetTeamsByLeague(5);
        team3 = await TeamService.GetTeamsByLeague(2);
        StateHasChanged();
    }

    private async void UpdateLeague(ChangeEventArgs e)
    {
        int leagueId = Convert.ToInt32(e.Value);

        var result = await TeamService.GetTeamsByLeague(leagueId);

        Teams = result;
        StateHasChanged();
    }

    private string GetTeamLogoSrc(byte[] logo)
    {
        return logo != null ? $"data:image/png;base64,{Convert.ToBase64String(logo)}" : "/images/user.png";
    }
}
