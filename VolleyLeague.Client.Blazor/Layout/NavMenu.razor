@using VolleyLeague.Client.Blazor.Services
@using Microsoft.AspNetCore.Components.Authorization
@using VolleyLeague.Client.Blazor.Authentication
@using VolleyLeague.Client.Blazor.Shared.Dtos
@using static VolleyLeague.Client.Blazor.Services.AccountService
@using System.Net.Http.Headers
@using System.Globalization
@using VolleyLeague.Shared.Dtos.Teams
@inject AuthenticationStateProvider authStateProvider
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject IUserService userService
@inject NavigationManager Navigation
@inject ITeamService teamService

@if (IsHomePage)
{
    <header id="rtsHeader" class="rts-header3 rts-header7">
        <div class="navbar-sticky">
            <div class="inline-wrapper d-flex">
                <div class="navbar-wrapper">
                    <div class="navbar-part navbar-part3 navbar-upper d-flex">
                        <div class="container">
                            <div class="navbar-inner">
                                <a href="index.html" class="logo"><img src="assets/images/logonew.png" alt="sportius-logo" style="transform: scale(0.8);"></a>
                                <div class="rts-menu">
                                    <nav class="menus menu-toggle">
                                        <ul class="nav__menu">
                                        <li class="has-dropdown">
                                            <NavLink class="menu-item active1" href="/">Home</NavLink>
                                            </li>
                                        <li class="has-dropdown">
                                            <NavLink class="menu-item" href="#">Wyniki</NavLink>
                                            <ul class="dropdown-ul">
                                                <li class="dropdown-li">
                                                    <NavLink class="dropdown-link" href="/standings">Tabele</NavLink>
                                                </li>
                                                <li class="dropdown-li">
                                                    <NavLink class="dropdown-link" href="/mvp">MVP</NavLink>
                                                </li>
                                                <li class="dropdown-li">
                                                    <NavLink class="dropdown-link" href="/typedResults">Typermania</NavLink>
                                                </li>
                                            </ul>
                                        </li>
                                        <li class="has-dropdown">
                                            <NavLink class="menu-item active1" href="/schedule">Terminarz</NavLink>
                                        </li>
                                        <li class="has-dropdown">
                                            <NavLink class="menu-item active1" href="/teams-list">Zespoły</NavLink>
                                        </li>
                                        <li class="has-dropdown">
                                            <NavLink class="menu-item active1" href="/policy">Liga</NavLink>
                                        </li>
                                        <li class="has-dropdown">
                                            <NavLink class="menu-item active1" href="/contact">Kontakt</NavLink>
                                        </li>
                                           
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <a class="hamburger-menu aitem">
                                <div class="hamburger-menu-inner">
                                    <span></span>
                                    <span class=""></span>
                                    <span></span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </header>
}
else
{
        <header id="rtsHeader" class="rts-header3 rts-header7">
        <div class="navbar-sticky">
            <div class="inline-wrapper d-flex">
                <div class="navbar-wrapper">
                    <div class="navbar-part navbar-part3 navbar-upper d-flex">
                        <div class="container">
                    <div class="navbar-inner">
                        <a href="index.html" class="logo"><img src="assets/images/logonew.png" alt="sportius-logo" style="transform: scale(0.8);"></a>
                        <div class="rts-menu">
                            <nav class="menus menu-toggle">
                                <ul class="nav__menu">
                                    <li class="has-dropdown">
                                        <NavLink class="menu-item active1" href="/">Home</NavLink>
                                    </li>
                                    <li class="has-dropdown">
                                        <NavLink class="menu-item" href="#">Wyniki</NavLink>
                                        <ul class="dropdown-ul">
                                            <li class="dropdown-li">
                                                <NavLink class="dropdown-link" href="/standings">Tabele</NavLink>
                                            </li>
                                            <li class="dropdown-li">
                                                <NavLink class="dropdown-link" href="/mvp">MVP</NavLink>
                                            </li>
                                            <li class="dropdown-li">
                                                <NavLink class="dropdown-link" href="/typedResults">Typermania</NavLink>
                                            </li>
                                        </ul>
                                    </li>
                                    <li class="has-dropdown">
                                        <NavLink class="menu-item active1" href="/schedule">Terminarz</NavLink>
                                    </li>
                                    <li class="has-dropdown">
                                        <NavLink class="menu-item active1" href="/teams-list">Zespoły</NavLink>
                                    </li>
                                    <li class="has-dropdown">
                                        <NavLink class="menu-item active1" href="/policy">Liga</NavLink>
                                    </li>
                                    <li class="has-dropdown">
                                        <NavLink class="menu-item active1" href="/contact">Kontakt</NavLink>
                                    </li>

                                </ul>
                            </nav>
                        </div>
                            </div>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="cart-bar">
            <div class="cart-header">
                <h3 class="cart-heading">MY CART (3 ITEMS)</h3>
                <div class="close-cart"><i class="fal fa-times"></i></div>
            </div>
            <div class="product-area">
                <div class="product-item">
                    <div class="product-detail">
                        <div class="product-thumb">
                            <img src="assets/images/products/product1.png" alt="product-thumb">
                        </div>
                        <div class="item-wrapper">
                            <span class="product-name">Parachute Jacket</span>
                            <div class="item-wrapper">
                                <span class="product-variation">
                                    <span class="color">Green /</span>
                                    <span class="size">XL</span>
                                </span>
                            </div>
                            <div class="item-wrapper">
                                <span class="product-qnty">3 ×</span>
                                <span class="product-price">$198.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="cart-edit">
                        <div class="quantity-edit">
                            <button class="button"><i class="fal fa-minus minus"></i></button>
                            <input type="text" class="input" value="3" />
                            <button class="button plus">+<i class="fal fa-plus plus"></i></button>
                        </div>
                        <div class="item-wrapper d-flex mr--5 align-items-center">
                            <a href="#" class="product-edit"><i class="fal fa-edit"></i></a>
                            <a href="#" class="delete-cart"><i class="fal fa-times"></i></a>
                        </div>
                    </div>
                </div>
                <div class="product-item">
                    <div class="product-detail">
                        <div class="product-thumb">
                            <img src="assets/images/products/product2.png" alt="product-thumb">
                        </div>
                        <div class="item-wrapper">
                            <span class="product-name">Narrow Trouser</span>
                            <div class="item-wrapper">
                                <span class="product-variation">
                                    <span class="color">Green /</span>
                                    <span class="size">XL</span>
                                </span>
                            </div>
                            <div class="item-wrapper">
                                <span class="product-qnty">2 ×</span>
                                <span class="product-price">$88.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="cart-edit">
                        <div class="quantity-edit">
                            <button class="button"><i class="fal fa-minus minus"></i></button>
                            <input type="text" class="input" value="2" />
                            <button class="button plus">+<i class="fal fa-plus plus"></i></button>
                        </div>
                        <div class="item-wrapper d-flex mr--5 align-items-center">
                            <a href="#" class="product-edit"><i class="fal fa-edit"></i></a>
                            <a href="#" class="delete-cart"><i class="fal fa-times"></i></a>
                        </div>
                    </div>
                </div>
                <div class="product-item last-child">
                    <div class="product-detail">
                        <div class="product-thumb">
                            <img src="assets/images/products/product6.png" alt="product-thumb">
                        </div>
                        <div class="item-wrapper">
                            <span class="product-name">Bellyless Hoodie</span>
                            <div class="item-wrapper">
                                <span class="product-variation">
                                    <span class="color">Green /</span>
                                    <span class="size">XL</span>
                                </span>
                            </div>
                            <div class="item-wrapper">
                                <span class="product-qnty">1 ×</span>
                                <span class="product-price">$289.00</span>
                            </div>
                        </div>
                    </div>
                    <div class="cart-edit">
                        <div class="quantity-edit">
                            <button class="button"><i class="fal fa-minus minus"></i></button>
                            <input type="text" class="input" value="2" />
                            <button class="button plus">+<i class="fal fa-plus plus"></i></button>
                        </div>
                        <div class="item-wrapper d-flex mr--5 align-items-center">
                            <a href="#" class="product-edit"><i class="fal fa-edit"></i></a>
                            <a href="#" class="delete-cart"><i class="fal fa-times"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="cart-bottom-area">
                <span class="spend-shipping">
                    <i class="fal fa-truck"></i> SPENT <span class="amount">$199.00</span> MORE
                    FOR FREE SHIPPING
                </span>
                <span class="total-price">TOTAL: <span class="price">$556</span></span>
                <a href="checkout.html" class="checkout-btn cart-btn">PROCEED TO CHECKOUT</a>
                <a href="cart.html" class="view-btn cart-btn">VIEW CART</a>
            </div>
        </div>
        <!--================= Slide Bar Start Here =================-->
        <aside class="slide-bar">
            <div class="offset-sidebar">
                <button class="slide-bar-close ml--30"><i class="fal fa-times"></i></button>
                <div class="offset-widget offset-logo mb-30">
                    <a href="index.html">
                        <img src="assets/images/logo.png" alt="logo">
                    </a>
                </div>
            </div>
            <!-- side-mobile-menu start -->
            <nav class="side-mobile-menu side-mobile-menu1">
                <ul id="mobile-menu-active">
                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="index.html">Home <i class="rt-angle-down"></i></a>
                        <ul class="sub-menu">
                            <li><a href="index.html">Home Style 1</a></li>
                            <li><a href="index-two.html">Home Style 2</a></li>
                            <li><a href="index-three.html">Home Style 3</a></li>
                            <li><a href="index-four.html">Home Style 4</a></li>
                            <li><a href="index-five.html">Home Style 5</a></li>
                            <li><a href="index-six.html">Home Style 6</a></li>
                            <li><a href="index-seven.html">Home Style 7</a></li>
                            <li><a href="index-eight.html">Home Style 8</a></li>
                        </ul>
                    </li>
                    <li><a class="mm-link" href="about.html">About</a></li>
                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="index.html">Pages <i class="rt-angle-down"></i></a>
                        <ul class="sub-menu mega-dropdown-mobile">
                            <li class="mega-dropdown-li">
                                <ul class="mega-dropdown-ul mm-show">
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="team.html">Team Details</a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="team-details.html">
                                            Player
                                            Details
                                        </a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="history.html">History</a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="awards.html">Awards</a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="faq.html">FAQ</a>
                                    </li>
                                    </ul>
                            </li>
                            <li class="mega-dropdown-li">
                                <ul class="mega-dropdown-ul mm-show">
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="gallery.html">Gallery</a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="event.html">Event</a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="event-details.html">
                                            Event
                                            Details
                                        </a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="error.html">Error</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="mega-dropdown-li">
                                <ul class="mega-dropdown-ul mm-show">
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="match-schedule.html">
                                            Match
                                            Schedule
                                        </a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="match-result.html">
                                            Match
                                            Result
                                        </a>
                                    </li>
                                    <li class="dropdown-li">
                                        <a class="dropdown-link" href="league-standings.html">Point Table</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="index.html">Shop <i class="rt-angle-down"></i></a>
                        <ul class="sub-menu">
                            <li><a href="shop.html">Shop</a></li>
                            <li><a href="product-details.html">Product Details</a></li>
                            <li><a href="cart.html">cart</a></li>
                            <li><a href="checkout.html">Checkout</a></li>
                            <li><a href="account.html">My Account</a></li>
                            <li><a href="thank-you.html">Thank You</a></li>
                        </ul>
                    </li>
                    <li class="has-dropdown firstlvl">
                        <a class="mm-link" href="news-details.html">News <i class="rt-angle-down"></i></a>
                        <ul class="sub-menu">
                            <li><a href="blog.html">News</a></li>
                            <li><a href="blog-details.html">News Details</a></li>
                        </ul>
                    </li>
                    <li><a class="mm-link" href="contact.html">Contact</a></li>
                </ul>
            </nav>
            <!-- side-mobile-menu end -->
            <div class="side-bar-social-links">
                <a href="#0" class="platform"><i class="fab fa-facebook-f"></i></a>
                <a href="#0" class="platform"><i class="fab fa-twitter"></i></a>
                <a href="#0" class="platform"><i class="fab fa-behance"></i></a>
                <a href="#0" class="platform"><i class="fab fa-youtube"></i></a>
            </div>
        </aside>
        <!--================= Slide Bar Start Here =================-->
        <!--================= Banner Section Start Here =================-->
        <div class="banner banner1">
            <div class="inner-page-banner banner-bg">
                <div class="container">
                    <div class="banner-content">
                        <div class="page-path">
                            <ul>
                                <li><a class="home-page-link" href="index.html">Strona Główna</a></li>
                                <li><a class="current-page" href="#">Tabela wyników</a></li>
                            </ul>
                        </div>
                        <h1 class="banner-heading">WYNIKI LIGII</h1>
                    </div>
                </div>
            </div>
        </div>
        <!--================= Banner Section End Here =================-->
    </header>
}

<style>
    .nav-item.nav-user {
        color: #7d7d7d;
        text-decoration: none;
        font-size: 9px;
    }
</style>

@code {
    private bool collapseNavMenu = true;
    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;
    private bool HasTeam { get; set; } = false;
    PlayerSummaryDto playerSummary = new PlayerSummaryDto();
    private bool IsPlayer { get; set; }
    private bool IsAdmin { get; set; }
    private bool IsHomePage => Navigation.Uri.EndsWith("/");

    [Inject]
    public NavigationManager NavigationManager { get; set; } = null!;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override async Task OnInitializedAsync()
    {
        Navigation.LocationChanged += OnLocationChanged;

        var authState = await authStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            IsPlayer = user.IsInRole("Player");
            IsAdmin = user.IsInRole("Admin");

            playerSummary = await userService.GetUserSummary();
            HasTeam = await userService.IsTeamCaptain();
        }
    }

    private void OnLocationChanged(object? sender, Microsoft.AspNetCore.Components.Routing.LocationChangedEventArgs e)
    {
        // Reload the page on any navigation change
        Navigation.NavigateTo(Navigation.Uri, forceLoad: true);
    }

    public async void Logout()
    {
        await localStorage.RemoveItemAsync("token");
        ((CustomAuthenticationStateProvider)authStateProvider).NotifyUserLogout();
        NavigationManager.NavigateTo("/", forceLoad: true);
    }

    private string GetDayName(DateTime date)
    {
        return date.ToString("dddd", new CultureInfo("pl-PL"));
    }

    private string GetFormattedDate(DateTime date)
    {
        return date.ToString("dd MMMM yyyy", new CultureInfo("pl-PL"));
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
